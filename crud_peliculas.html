<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>CRUD Películas Completo</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #121212;
      color: #f1f1f1;
    }
    header {
      background-color: #1e1e1e;
      padding: 20px;
      text-align: center;
    }
    h1 {
      margin: 0;
      color: #00e676;
    }
    .container {
      padding: 20px;
      max-width: 1200px;
      margin: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    th, td {
      padding: 12px;
      border: 1px solid #444;
      text-align: left;
    }
    th {
      background-color: #1e1e1e;
      color: #00e676;
    }
    tr:hover {
      background-color: #2a2a2a;
    }
    button {
      background-color: #00e676;
      border: none;
      padding: 6px 10px;
      color: black;
      cursor: pointer;
      border-radius: 4px;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0,0,0,0.9);
      z-index: 1000;
      overflow-y: auto;
    }
    .modal-content {
      background: #1e1e1e;
      color: #fff;
      margin: 5% auto;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
    }
    .modal input, .modal textarea {
      width: 100%;
      margin-bottom: 10px;
      padding: 8px;
      background: #2a2a2a;
      color: white;
      border: none;
      border-radius: 4px;
    }
    .close {
      float: right;
      font-size: 22px;
      color: red;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header><h1>Películas</h1></header>
  <div class="container">
    <button onclick="abrirModal()">Agregar Película</button>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Título</th>
          <th>Año</th>
          <th>País</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="tabla"></tbody>
    </table>
  </div>

  <div class="modal" id="modal">
    <div class="modal-content">
      <span class="close" onclick="cerrarModal()">&times;</span>
      <h2 id="modal-titulo">Nueva Película</h2>
      <input type="hidden" id="id">
      <input type="text" id="titulo_espanol" placeholder="Título Español">
      <input type="text" id="titulo_original" placeholder="Título Original">
      <input type="number" id="ano_estreno" placeholder="Año Estreno">
      <input type="text" id="pais" placeholder="País">
      <input type="number" id="duracion" placeholder="Duración (minutos)">
      <input type="text" id="calificacion" placeholder="Calificación">
      <input type="date" id="fecha_estreno" placeholder="Fecha Estreno">
      <input type="text" id="imagen_portada" placeholder="URL Imagen">
      <input type="text" id="trailer_url" placeholder="URL Trailer">
      <textarea id="sinopsis" placeholder="Sinopsis"></textarea>
      <button onclick="guardar()">Guardar</button>
    </div>
  </div>

  <script>
    const api = "http://localhost:3000/api/peliculas";
    const tabla = document.getElementById("tabla");
    const modal = document.getElementById("modal");

    const cargar = async () => {
      const res = await fetch(api);
      const data = await res.json();
      tabla.innerHTML = "";
      data.forEach(p => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${p.id}</td>
          <td>${p.titulo_espanol}</td>
          <td>${p.ano_estreno}</td>
          <td>${p.pais}</td>
          <td>
            <button onclick='editar(${JSON.stringify(p)})'>Editar</button>
            <button onclick='eliminar(${p.id})'>Eliminar</button>
          </td>
        `;
        tabla.appendChild(tr);
      });
    };

    const abrirModal = () => {
      document.getElementById("modal-titulo").textContent = "Nueva Película";
      document.querySelectorAll("#modal input, #modal textarea").forEach(el => el.value = "");
      modal.style.display = "block";
    };

    const cerrarModal = () => {
      modal.style.display = "none";
    };

    const guardar = async () => {
      const datos = {
        titulo_espanol: titulo_espanol.value,
        titulo_original: titulo_original.value,
        ano_estreno: parseInt(ano_estreno.value),
        pais: pais.value,
        duracion: parseInt(duracion.value),
        calificacion: calificacion.value,
        fecha_estreno: fecha_estreno.value,
        imagen_portada: imagen_portada.value,
        trailer_url: trailer_url.value,
        sinopsis: sinopsis.value,
      };

      const id = document.getElementById("id").value;
      const url = id ? `${api}/${id}` : api;
      const method = id ? "PUT" : "POST";

      await fetch(url, {
        method,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(datos)
      });

      cerrarModal();
      cargar();
    };

    const editar = (p) => {
      document.getElementById("modal-titulo").textContent = "Editar Película";
      id.value = p.id;
      titulo_espanol.value = p.titulo_espanol || "";
      titulo_original.value = p.titulo_original || "";
      ano_estreno.value = p.ano_estreno || "";
      pais.value = p.pais || "";
      duracion.value = p.duracion || "";
      calificacion.value = p.calificacion || "";
      fecha_estreno.value = p.fecha_estreno || "";
      imagen_portada.value = p.imagen_portada || "";
      trailer_url.value = p.trailer_url || "";
      sinopsis.value = p.sinopsis || "";
      modal.style.display = "block";
    };

    const eliminar = async (id) => {
      if (confirm("¿Eliminar esta película?")) {
        await fetch(`${api}/${id}`, { method: "DELETE" });
        cargar();
      }
    };

    window.onclick = e => { if (e.target === modal) cerrarModal(); };

    cargar();
  </script>
</body>
</html>
